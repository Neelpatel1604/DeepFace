(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{7:(e,t,a)=>{"use strict";a.d(t,{cn:()=>i});var r=a(4584),s=a(2292);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},1832:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var r=a(3365),s=a(1521),i=a(544),n=a(2934),o=a(7);let l=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:c=!1,...d}=e,h=c?i.DX:"button";return(0,r.jsx)(h,{className:(0,o.cn)(l({variant:s,size:n,className:a})),ref:t,...d})});c.displayName="Button"},3408:(e,t,a)=>{Promise.resolve().then(a.bind(a,8198))},3634:(e,t,a)=>{"use strict";a.d(t,{J:()=>c});var r=a(3365),s=a(1521),i=a(2711),n=a(2934),o=a(7);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(i.b,{ref:t,className:(0,o.cn)(l(),a),...s})});c.displayName=i.b.displayName},4333:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(9178);class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}setupEventListeners(){this.obs.on("ConnectionOpened",()=>{this.connectionStatus=!0,this.notifyStatusListeners()}),this.obs.on("ConnectionClosed",()=>{this.connectionStatus=!1,this.notifyStatusListeners()})}async connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"localhost:4455",t=arguments.length>1?arguments[1]:void 0;try{return this.currentPassword=t,await this.obs.connect("ws://".concat(e),t),!0}catch(e){return console.error("Failed to connect:",e),!1}}async disconnect(){try{return await this.obs.disconnect(),!0}catch(e){return console.error("Failed to disconnect:",e),!1}}isConnected(){return this.connectionStatus}addStatusListener(e){this.statusListeners.push(e)}removeStatusListener(e){this.statusListeners=this.statusListeners.filter(t=>t!==e)}notifyStatusListeners(){this.statusListeners.forEach(e=>e(this.connectionStatus))}async getScenes(){try{let{scenes:e}=await this.obs.call("GetSceneList");return e}catch(e){return console.error("Failed to get scenes:",e),[]}}async getCurrentScene(){try{let{currentProgramSceneName:e}=await this.obs.call("GetCurrentProgramScene");return e}catch(e){return console.error("Failed to get current scene:",e),null}}async applyProtectionFilter(e,t){try{let a=(await this.obs.call("GetSourceFilterList",{sourceName:e})).filters.some(e=>"DeepfakeProtection"===e.filterName),r={contrast:1+t.strength/200,brightness:1-t.strength/400,gamma:1+10*t.alpha,saturation:1+t.epsilon,hue_shift:t.iterations%360,opacity:1};return a?await this.obs.call("SetSourceFilterSettings",{sourceName:e,filterName:"DeepfakeProtection",filterSettings:r}):await this.obs.call("CreateSourceFilter",{sourceName:e,filterName:"DeepfakeProtection",filterKind:"color_filter_v2",filterSettings:r}),await this.obs.call("SetSourceFilterEnabled",{sourceName:e,filterName:"DeepfakeProtection",filterEnabled:!0}),!0}catch(e){return console.error("Failed to apply protection filter:",e),!1}}async removeProtectionFilter(e){try{try{await this.obs.call("SetSourceFilterEnabled",{sourceName:e,filterName:"DeepfakeProtection",filterEnabled:!1}),await this.obs.call("SetSourceFilterEnabled",{sourceName:e,filterName:"DeepfakeProtection_LUT",filterEnabled:!1})}catch(e){console.warn("Failed to disable filters:",e)}try{await this.obs.call("RemoveSourceFilter",{sourceName:e,filterName:"DeepfakeProtection"})}catch(e){console.warn("Failed to remove color filter:",e)}try{await this.obs.call("RemoveSourceFilter",{sourceName:e,filterName:"DeepfakeProtection_LUT"})}catch(e){console.warn("Failed to remove LUT filter:",e)}return!0}catch(e){return console.error("Failed to remove protection filters:",e),!1}}async startVirtualCamera(){try{return await this.obs.call("StartVirtualCam"),!0}catch(e){return console.error("Failed to start virtual camera:",e),!1}}async stopVirtualCamera(){try{return await this.obs.call("StopVirtualCam"),!0}catch(e){return console.error("Failed to stop virtual camera:",e),!1}}async getSceneSources(e){try{let{sceneItems:t}=await this.obs.call("GetSceneItemList",{sceneName:e});return t.map(e=>({sourceName:e.sourceName}))}catch(e){return console.error("Failed to get scene sources:",e),[]}}constructor(){this.connectionStatus=!1,this.statusListeners=[],this.obs=new r.Ay,this.setupEventListeners()}}let i=s},6305:()=>{},8198:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(3365),s=a(1521),i=a(627),n=a(2372),o=a(4333);class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}async initializeStreams(){try{this.obsManager.isConnected()&&!await this.obsManager.startVirtualCamera()&&console.warn("Failed to start OBS Virtual Camera."),this.originalStream=await navigator.mediaDevices.getUserMedia({video:!0}),this.videoElement=document.createElement("video"),this.videoElement.srcObject=this.originalStream,this.videoElement.play(),this.protectedCanvas=document.createElement("canvas"),this.hashCanvas=document.createElement("canvas"),this.protectedCanvas.width=1280,this.protectedCanvas.height=720,this.hashCanvas.width=1280,this.hashCanvas.height=720;let e=this.protectedCanvas.getContext("2d",{alpha:!1,desynchronized:!0}),t=this.hashCanvas.getContext("2d",{alpha:!1,desynchronized:!0});if(!e||!t)throw Error("Failed to get canvas contexts");e.imageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1;let a=r=>{if(this.videoElement&&e&&t&&this.protectedCanvas&&this.hashCanvas){if(0!==this.lastFrameTime){let e=r-this.lastFrameTime;this.frameCount++,30===this.frameCount&&(this.fps=1e3/(e/30),this.frameCount=0)}if(this.lastFrameTime=r,e.drawImage(this.videoElement,0,0,this.protectedCanvas.width,this.protectedCanvas.height),t.drawImage(this.videoElement,0,0,this.hashCanvas.width,this.hashCanvas.height),this.isProtectionActive){let a=e.getImageData(0,0,this.protectedCanvas.width,this.protectedCanvas.height);this.applyProtection(a),e.putImageData(a,0,0);let s=t.getImageData(0,0,this.hashCanvas.width,this.hashCanvas.height);this.generateHashVisualization(s,r),t.putImageData(s,0,0)}this.drawProtectionOverlay(e,this.protectionStrength),this.drawFPSOverlay(t),this.sendToOBS(),this.animationFrameId=requestAnimationFrame(a)}};return this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(a),this.protectedStream=this.protectedCanvas.captureStream(30),this.hashStream=this.hashCanvas.captureStream(30),!0}catch(e){return console.error("Failed to initialize streams:",e),!1}}async sendToOBS(){if(this.protectedStream&&this.obsManager.isConnected())try{await this.obsManager.applyProtectionFilter("WebAppProtectedSource",{model:"default",strength:100*this.protectionStrength,iterations:10,alpha:.01,epsilon:.1,targetArea:"full"})}catch(e){console.error("Failed to send to OBS:",e)}}async getStreamFromOBS(){try{if(!this.obsManager.isConnected())return console.warn("OBS not connected; returning local protected stream."),this.protectedStream;if(this.obsVirtualCameraStream=await navigator.mediaDevices.getUserMedia({video:{deviceId:"OBS Virtual Camera"}}),this.obsVirtualCameraStream)return this.obsVirtualCameraStream;return console.warn("Failed to get OBS Virtual Camera stream; using local protected stream."),this.protectedStream}catch(e){return console.error("Failed to get stream from OBS:",e),this.protectedStream}}setProtectionActive(e){this.isProtectionActive=e}setProtectionStrength(e){this.protectionStrength=Math.max(0,Math.min(1,e))}getOriginalStream(){return this.originalStream}getProtectedStream(){return this.protectedStream}getHashStream(){return this.hashStream}cleanup(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.originalStream&&this.originalStream.getTracks().forEach(e=>e.stop()),this.obsVirtualCameraStream&&(this.obsVirtualCameraStream.getTracks().forEach(e=>e.stop()),this.obsVirtualCameraStream=null),this.originalStream=null,this.protectedStream=null,this.hashStream=null,this.protectedCanvas=null,this.hashCanvas=null}applyProtection(e){let t=e.data,a=2*this.protectionStrength,r=.1*Date.now(),s=new Uint32Array(t.buffer),i=s.length;for(let e=0;e<i;e++){let t=Math.sin(r+.001*e)*a,i=s[e],n=Math.max(0,Math.min(255,(i>>24&255)+t)),o=Math.max(0,Math.min(255,(i>>16&255)+t)),l=Math.max(0,Math.min(255,(i>>8&255)+t));s[e]=n<<24|o<<16|l<<8|255}}generateHashVisualization(e,t){let a=e.data,r=.001*t,s=e.width,i=e.height,n=new Uint32Array(a.buffer),o=n.length;for(let e=0;e<o;e++){let t=e%s/s,a=Math.floor(e/s)/i,o=(Math.sin(10*t+r)*Math.cos(10*a+r)+Math.sin(20*Math.sqrt((t-.5)**2+(a-.5)**2)-2*r))*.5*(((n[e]>>24&255)*.299+(n[e]>>16&255)*.587+(n[e]>>8&255)*.114)/255),l=(50*r+360*o)%360,[c,d,h]=this.hslToRgb(l/360,.8,.5+.5*o);n[e]=c<<24|d<<16|h<<8|255}}drawProtectionOverlay(e,t){let a="Protection: ".concat(Math.round(100*t),"%");e.font="16px monospace",e.fillStyle="rgba(0, 255, 0, ".concat(.5*t,")"),e.fillText(a,10,20)}drawFPSOverlay(e){let t="FPS: ".concat(Math.round(this.fps));e.font="16px monospace",e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillText(t,10,20)}hslToRgb(e,t,a){let r,s,i;if(0===t)r=s=i=a;else{let n=(e,t,a)=>(a<0&&(a+=1),a>1&&(a-=1),a<1/6)?e+(t-e)*6*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e,o=a<.5?a*(1+t):a+t-a*t,l=2*a-o;r=n(l,o,e+1/3),s=n(l,o,e),i=n(l,o,e-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*i)]}constructor(){this.originalStream=null,this.protectedStream=null,this.hashStream=null,this.protectedCanvas=null,this.hashCanvas=null,this.animationFrameId=null,this.obsVirtualCameraStream=null,this.videoElement=null,this.isProtectionActive=!1,this.protectionStrength=.5,this.lastFrameTime=0,this.frameCount=0,this.fps=0,this.obsManager=o.A.getInstance()}}var c=a(1832),d=a(3198),h=a(7);let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(d.bL,{ref:t,className:(0,h.cn)("relative flex w-full touch-none select-none items-center",a),...s,children:[(0,r.jsx)(d.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-gray-700",children:(0,r.jsx)(d.Q6,{className:"absolute h-full bg-blue-500"})}),(0,r.jsx)(d.zi,{className:"block h-5 w-5 rounded-full border-2 border-blue-500 bg-white ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});m.displayName=d.bL.displayName;var u=a(3634);function g(){let e=(0,s.useRef)(null),t=(0,s.useRef)(null),a=(0,s.useRef)(null),o=(0,s.useRef)(null),d=l.getInstance(),[h,g]=(0,s.useState)(null),[p,b]=(0,s.useState)(50),[f,v]=(0,s.useState)(!1),[x,y]=(0,s.useState)("Idle"),[S,w]=(0,s.useState)(""),N=(0,i.useRouter)(),[j,C]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e;return f?e=setInterval(()=>{C(t=>{let a=Math.min(t+5,p);return a>=p&&clearInterval(e),a})},50):C(0),()=>{clearInterval(e)}},[f,p]),(0,s.useEffect)(()=>{let e;let t=o.current;if(!t)return;let a=t.getContext("2d");if(!a)return;t.width=t.clientWidth,t.height=t.clientHeight;let r=()=>{let s=a.createImageData(t.width,t.height),i=s.data;for(let e=0;e<i.length;e+=4){let t=p/100*400*Math.random();i[e]=t,i[e+1]=t,i[e+2]=t,i[e+3]=255}a.putImageData(s,0,0),e=requestAnimationFrame(r)};return f&&r(),()=>{cancelAnimationFrame(e)}},[p,f]),(0,s.useEffect)(()=>((async()=>{try{if(!await d.initializeStreams()){w("Failed to initialize video streams"),n.oR.error("Failed to initialize streams");return}let r=await d.getStreamFromOBS();r&&t.current?(g(r),t.current.srcObject=r):(w("Failed to retrieve protected stream from OBS; using local stream as fallback."),n.oR.error("Failed to retrieve protected stream from OBS; using local stream as fallback."),t.current&&(t.current.srcObject=d.getProtectedStream())),e.current&&(e.current.srcObject=d.getOriginalStream()),a.current&&(a.current.srcObject=d.getHashStream())}catch(e){w("Failed to initialize video streams"),n.oR.error("Failed to initialize streams: "+e.message),console.error("Stream initialization error:",e)}})(),()=>{d.cleanup(),h&&h.getTracks().forEach(e=>e.stop()),d.obsManager.isConnected()&&d.obsManager.stopVirtualCamera()}),[]),(0,r.jsxs)("main",{className:"min-h-screen bg-gradient-to-b from-gray-900 to-black text-white p-8",children:[(0,r.jsx)(n.l$,{position:"top-right"}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600",children:"Video Stream Protection"}),(0,r.jsx)(c.$,{onClick:()=>N.push("/"),variant:"outline",className:"border-gray-600 cursor-pointer",children:"Back to Settings"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg backdrop-blur-sm border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Original"}),(0,r.jsx)("span",{className:"text-sm text-yellow-400",children:"Trainable"})]}),(0,r.jsxs)("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden relative",children:[(0,r.jsx)("video",{ref:e,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 text-xs text-white bg-black/50 px-2 py-1 rounded",children:"Raw Input"})]})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg backdrop-blur-sm border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Hash Visualization"}),(0,r.jsx)("span",{className:"text-sm text-blue-400",children:"Processing"})]}),(0,r.jsxs)("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden relative",children:[(0,r.jsx)("canvas",{ref:o,className:"w-full h-full object-cover"}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 text-xs text-white bg-black/50 px-2 py-1 rounded",children:"Protection Pattern"}),f&&(0,r.jsxs)("div",{className:"absolute top-2 right-2 text-xs text-white bg-green-600/70 px-2 py-1 rounded",children:[Math.round(j),"% Active"]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg backdrop-blur-sm border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Protected"}),(0,r.jsx)("span",{className:"text-sm text-green-400",children:"Secured"})]}),(0,r.jsxs)("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden relative",children:[(0,r.jsx)("video",{ref:t,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 text-xs text-white bg-black/50 px-2 py-1 rounded",children:"Protected Output"})]})]})]}),(0,r.jsx)("div",{className:"bg-gray-800/30 p-4 rounded-lg backdrop-blur-sm border border-gray-700",children:(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-400 mb-1",children:"Original Stream"}),(0,r.jsx)("p",{className:"text-yellow-400",children:"Unprotected feed - vulnerable to deepfake training"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-400 mb-1",children:"Hash Visualization"}),(0,r.jsx)("p",{className:"text-blue-400",children:"Real-time protection pattern generation"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-400 mb-1",children:"Protected Stream"}),(0,r.jsx)("p",{className:"text-green-400",children:"Adversarial protection applied - resistant to deepfakes"})]})]})})]}),(0,r.jsx)("div",{className:"bg-gray-800/50 p-6 rounded-lg backdrop-blur-sm border border-gray-700",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(u.J,{htmlFor:"strength",children:"Protection Strength"}),(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:[p," %"]})]}),(0,r.jsx)(m,{id:"strength",value:[p],onValueChange:e=>{let t=e[0];if(b(t),f)try{d.setProtectionStrength(t/100)}catch(e){w("Failed to update protection strength"),console.error("Strength update error:",e),n.oR.error("Failed to update protection strength")}},min:0,max:100,step:1,className:"w-full",disabled:!f}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-400",children:["Status: ",x]}),(0,r.jsx)(c.$,{onClick:()=>{try{let e=!f;d.setProtectionActive(e),v(e),y(e?"Protection applied":"Protection removed"),n.oR.success(e?"Protection applied successfully":"Protection removed successfully")}catch(e){w("Failed to toggle protection"),console.error("Protection toggle error:",e),n.oR.error("Failed to toggle protection")}},className:"".concat(f?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"),children:f?"Remove Protection":"Apply Protection"})]})]})}),S&&(0,r.jsx)("div",{className:"bg-red-900/50 p-4 rounded-lg border border-red-700",children:(0,r.jsx)("p",{className:"text-red-400",children:S})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[762,198,347,870,358],()=>t(3408)),_N_E=e.O()}]);